<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Line Graph</title>
    <!-- You need these lines if you ARE using a Node server -->
    <script src="bower_components/jquery/dist/jquery.min.js" type="text/javascript"></script>
    <script src="bower_components/underscore/underscore.js" type="text/javascript"></script>
    <script src="bower_components/d3/d3.min.js" type="text/javascript"></script>

    <!-- You need this line if you're NOT using a Node server -->
    <script type="text/javascript" src="https://d3js.org/d3.v4.min.js"></script>
</head>

<body>
    <script>
        d3.csv("data/birthrates.csv",

            function(error, data) {
                //If there's an error loading the data, print it out, then stop
                if (error) {
                    console.log("ERROR:");
                    console.log(error);
                    return;
                }

                //We're going to pre-process the data here
                //For now, we want to look at just one country. I'm picking the United Kingdom, but you can
                //pick whichever country you want
                var countryOfInterest = "United Kingdom";
                //Then, we're creating an empty array to hold our processed data
                var processedData = [];

                //For every country in the data:
                data.forEach(function(d) {

                    //Check if it's the country we're interested in:
                    if (countryOfInterest == d["Country Name"]) {
                        //To get all of the years, we could write a for-loop, like this:
                        //for(year = 1960; year < 2016; year++){}

                        //But instead, let's use the column headings

                        //data.columns gets the names of all the columns, and .slice(5) removes the first five headings
                        //(Obviously, this would be different for different files, so be careful!)
                        var years = data.columns.slice(5);
                        years.forEach(function(year) {

                            //For each year, create a new dataPoint, store the year and associated birthrate...
                            var dataPoint = {}
                            dataPoint.year = new Date(+year, 0, 1);
                            dataPoint.birthrate = +d[year];

                            //...then store it in the array of processedData
                            processedData.push(dataPoint);
                        });
                    }
                });

                //Lastly, just for consistency, we rename processedData to data
                data = processedData;
                //Let's check it worked:
                console.log("Our data contains:");
                console.log(data);

                //Now we'll set up the SVG;
                //if you're unsure how this works, refer back to the last lab
                var margin = {
                    top: 100,
                    right: 100,
                    bottom: 100,
                    left: 100
                };
                var width = 800;
                var height = 300;

                var svg = d3.select('body')
                    .append('svg')
                    .attr('width', width + margin.left + margin.right)
                    .attr('height', height + margin.top + margin.bottom)
                    .append('g')
                    .attr('transform', 'translate(' + margin.left + ',' + margin.top + ")");


                //Now we'll set up the scales;
                //if you're unsure how this works, refer back to the last lab
                var x = d3.scaleTime()
                    .domain(d3.extent(data, function(d) {
                        return d.year
                    }))
                    .range([0, width]);

                var y = d3.scaleLinear()
                    .domain(d3.extent(data, function(d) {
                        return d.birthrate;
                    }))
                    .range([height, 0]);


                //Now to define the line!
                var line = d3.line()
                    .x(function(d) {
                        return x(d.year);
                    })
                    .y(function(d) {
                        return y(d.birthrate);
                    });

                svg.append("path")
                    .datum(data)
                    .attr("fill", "none")
                    .attr("stroke", "steelblue")
                    .attr("stroke-width", 2)
                    .attr("d", line);


                //And then add the axis;
                //if you're unsure how this works, refer back to the last lab
                svg.append("g")
                    .attr("transform", "translate(0," + height + ")")
                    .call(d3.axisBottom(x))

                //Append a label
                .append("text")
                    .attr("fill", "#000")
                    .attr("y", 40)
                    .attr("x", width / 2)
                    .attr("text-anchor", "middle")
                    .text("Year");

                svg.append("g")
                    .call(d3.axisLeft(y))

                //Append a label
                .append("text")
                    .attr("fill", "#000")
                    .attr("y", -40)
                    .attr("x", -height / 2)
                    .attr("transform", "rotate(-90)")
                    .attr("text-anchor", "middle")
                    .text("Average Birthrate (/1000 people)");

            }
        );
    </script>
</body>

</html>